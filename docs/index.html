<!-- start:readme.hbs -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
		<title>Haxroomie</title>
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
		<link type="text/css" rel="stylesheet" href="css/prism.min.css">
		<link type="text/css" rel="stylesheet" href="css/template.min.css">
		<script type="text/javascript">
			window.TEMPLATE_OPTIONS = {"includeDate":true,"dateFormat":"Do MMM YYYY","systemName":"Haxroomie","systemSummary":"Host HaxBall rooms without GUI.","systemLogo":"","systemColor":"","navMembers":[{"kind":"class","title":"Classes","summary":"All documented classes."},{"kind":"external","title":"Externals","summary":"All documented external members."},{"kind":"global","title":"Globals","summary":"All documented globals."},{"kind":"mixin","title":"Mixins","summary":"All documented mixins."},{"kind":"interface","title":"Interfaces","summary":"All documented interfaces."},{"kind":"module","title":"Modules","summary":"All documented modules."},{"kind":"namespace","title":"Namespaces","summary":"All documented namespaces."},{"kind":"tutorial","title":"Tutorials","summary":"All available tutorials."}],"footer":"","copyright":"© Oskari Pöntinen 2019","linenums":true,"collapseSymbols":true,"inverseNav":true,"inlineNav":false,"outputSourceFiles":true,"sourceRootPath":null,"disablePackagePath":true,"outputSourcePath":false,"showTableOfContents":true,"showAccessFilter":true,"analytics":null,"methodHeadingReturns":true,"sort":"linenum, longname, version, since","search":true,"favicon":null,"stylesheets":[],"scripts":[],"monospaceLinks":false,"cleverLinks":false};
			window.DOCLET_TOC_ENABLED = true;
			window.DOCLET_AFILTER_ENABLED = false;
		</script>
</head>
<body>
	<!-- start:navbar.hbs -->
	<header class="navbar navbar-default navbar-fixed-top navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand" href="index.html">
					Haxroomie
				</a>
				<!-- displayed on small devices -->
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="topNavigation">
				<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Globals<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="global.html#FileDef">FileDef</a></li>
											<li><a href="global.html#PluginData">PluginData</a></li>
											<li><a href="global.html#RoomEventArgs">RoomEventArgs</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_class.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="Haxroomie.html">Haxroomie</a></li>
											<li><a href="RoomController.html">RoomController</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_module.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="module-haxroomie.html">haxroomie</a></li>
									</ul>
								</li>
				</ul>
					<!-- start:lunr-search-navbar.hbs -->
					<form class="navbar-form navbar-right" role="search">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Search" id="lunr-search-input">
							<div class="input-group-btn">
								<button class="btn btn-default" id="lunr-search-submit">
									<i class="glyphicon glyphicon-search"></i>
								</button>
							</div>
						</div>
					</form>
					<!-- start:lunr-search-navbar.hbs -->		</div>
		</div>
	</header>
	<!-- end:navbar.hbs -->		<div class="page-header">
			<div class="container">
				<span class="kind">readme</span>
				<h1><span class="name">Haxroomie</span></h1>
				<div class="summary"><p>Host HaxBall rooms without GUI.</p></div>			</div>
		</div>
	<div class="container content">
		<div class="row">
			<div class="col-md-9 main-content">
		<section class="readme-section">
			<article><h1>Installation</h1>
<p>To be able to install and run haxroomie</p>
<ul>
<li><a href="https://nodejs.org">Node.js</a> version 10.15.1 or newer and</li>
<li><a href="https://git-scm.com/">Git</a></li>
</ul>
<p>are required.</p>
<p>To install haxroomie, clone the repository with git:</p>
<pre class="prettyprint source lang-sh"><code>git clone https://www.github.com/morko/haxroomie
</code></pre>
<p>Then go to the directory you cloned it and install dependencies with npm:</p>
<pre class="prettyprint source lang-sh"><code>cd haxroomie
npm install
</code></pre>
<p>Now you are ready to start using Haxroomie. See <a href="#cli-usage">CLI usage section</a>
for help on how to use the command line interface.</p>
<h2>Alternative installation</h2>
<p>You can also install haxroomie to a global npm installation directory.
This will give you a <code>haxroomie</code> command that you can run from
anywhere if your npm configuration is correct.</p>
<p>To install with npm run:</p>
<pre class="prettyprint source lang-sh"><code>npm install morko/haxroomie -g
</code></pre>
<p>This will probably fail if you havent set your global npm directory.
In linux machines it is recommended to set the directory to
somewhere where you dont need <code>sudo</code> to install npm packages.
To do so you can follow the guide in
<a href="https://medium.com/@sifium/using-npm-install-without-sudo-2de6f8a9e1a3">https://medium.com/@sifium/using-npm-install-without-sudo-2de6f8a9e1a3</a>:</p>
<ol>
<li>
<p>Create the .npm directory</p>
<pre class="prettyprint source lang-sh"><code>mkdir ~/.npm
</code></pre>
</li>
<li>
<p>Set npm to use the .npm directory as the default global installation directory</p>
<pre class="prettyprint source lang-sh"><code>npm config set prefix ~/.npm
</code></pre>
</li>
<li>
<p>Edit the .bashrc file</p>
<pre class="prettyprint source lang-sh"><code>nano ~/.bashrc
</code></pre>
</li>
<li>
<p>Add this line to the .bashrc file so the shell can find the haxroomie &quot;executable&quot;</p>
<pre class="prettyprint source lang-sh"><code>export PATH=&quot;$PATH:$HOME/.npm/bin&quot;
</code></pre>
</li>
<li>
<p>Reload the .bashrc file</p>
<pre class="prettyprint source lang-sh"><code>source ~/.bashrc
</code></pre>
</li>
</ol>
<h2>Troubleshooting</h2>
<p>From <a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/troubleshooting.md">puppeteer troubleshooting</a>:</p>
<p>Make sure all the necessary dependencies are installed.
You can run <code>ldd chrome | grep not</code> on a Linux machine
to check which dependencies are missing.</p>
<p>To install dependencies in Ubuntu based linux you can use the following command:</p>
<pre class="prettyprint source lang-sh"><code>sudo apt install gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget
</code></pre>
<h1>CLI usage</h1>
<p>To start the CLI it needs a config file. To get an easy start copy one of the
example configs from
<a href="https://github.com/morko/haxroomie/tree/master/examples/configs">haxroomie/examples/configs</a>
to the projects directory as <code>config.js</code> and modify it to your liking.
By default Haxroomie searches for <code>config.js</code> in the current working directory.</p>
<p>To start run:</p>
<pre class="prettyprint source lang-sh"><code>npm start
</code></pre>
<p>If you wish to load the config from elsewhere than <code>config.js</code> in the current
working directory you can give it the <code>-c</code> argument.</p>
<p>e.g.</p>
<pre class="prettyprint source lang-sh"><code>npm start -- -c [path/to/config.js]
</code></pre>
<p>*<em>Note the extra <code>--</code> when using the npm start command</em></p>
<p>if you installed with the alternative method:</p>
<pre class="prettyprint source lang-sh"><code>haxroomie -c [path/to/config.js]
</code></pre>
<p>Once Haxroomie CLI is running you can type <code>help</code> for available commands.</p>
<p>See <a href="#config">config section</a> for more information about the config file.</p>
<h2>Config</h2>
<p>Config file is a Node.js module that exports the config object. You dont really need to worry too much about what this means. Just edit the fields of the example config to your liking.</p>
<p>You can find examples of configs in
<a href="https://github.com/morko/haxroomie/tree/master/examples/configs">projects example directory</a>.</p>
<p>See the <a href="#config-properties-explained">config properties explained</a> for
information about each option.</p>
<p>Here is an example of a config that starts one private room.</p>
<pre class="prettyprint source lang-js"><code>let config = {
  /**
   * ID for the room. Haxroomie uses this internally to recognize the rooms.
   * Has to be unique.
   */
  'room1': {

    autoStart: true,
    roomName: 'haxroomie',
    playerName: 'host',
    maxPlayers: 12,
    public: false,
    geo: { code: 'eu', lat: '52.5192', lon: '13.4061'},
    repositories: [
      {
        type: 'github',
        repository: 'morko/hhm-plugins'
      },
    ],
    pluginConfig: {
      'sav/roles': {
        roles: {
          admin: 'adminpass',
          host: 'hostpass'
        }
      }
    }
  }
};
module.exports = config;
</code></pre>
<h3>Config properties explained</h3>
<ul>
<li>
<p><code>autoStart</code> Set to <code>true</code> if you want the room to start on startup. Default is <code>false</code>.</p>
</li>
<li>
<p><code>roomName</code> The name for the room. Default is <code>haxroomie</code></p>
</li>
<li>
<p><code>playerName</code> The name for the host player. Default is <code>host</code>.</p>
</li>
<li>
<p><code>maxPlayers</code> Max number of players the room accepts. Default is <code>10</code>.</p>
</li>
<li>
<p><code>public</code> If <code>true</code> the room will appear in the room list. Default is <code>false</code>.</p>
</li>
<li>
<p><code>geo</code> Geolocation override for the room. <code>geo : {&quot;code&quot;: string, &quot;lat&quot; : float, &quot;lon&quot; : float}</code>.
You can use <a href="https:%5C/%5C/www.latlong.net/">https://www.latlong.net/</a> to find the coordinates easily.
The code is a country code in two letter ISO format listed in
<a href="https:%5C/%5C/countrycode.org/">https://countrycode.org/</a>. Default is where your server is located.</p>
</li>
<li>
<p><code>repositories</code> Repository configuration array for the Haxball Headless Manager (HHM).
With this you can tell which repositories to load in addition to the default one.
By default haxroomie loads the
<a href="https://github.com/saviola777/hhm-plugins">plugin repository by saviola</a>.
<a href="https://github.com/saviola777/haxball-headless-manager#using-a-webserver">Here</a>
you can see how to add repository from an URL and
<a href="https://github.com/saviola777/haxball-headless-manager#using-a-github-repository">here</a>
how to add one from GitHub.</p>
</li>
<li>
<p><code>pluginConfig</code> Plugin configuration object for the Haxball Headless Manager (HHM).
With this you can tell which plugins to load from the repositories that are
available and give them optional configurations.
By default haxroomie loads the core plugin repository by saviola. You
can find these files in
<a href="https://github.com/saviola777/hhm-plugins/tree/master/src/sav">saviolas GitHub page</a>.
The files contain information about what kind of options they support
and what they do.
See <a href="https://github.com/saviola777/haxball-headless-manager#configuration-file">saviolas GitHub page</a>
for more detailed explanation about this configuration.
See
<a href="https://haxplugins.tk/docs/tutorial-writing-plugins.html">writing plugins tutorial</a>
for information about saviolas default plugins and how to write your own.</p>
</li>
<li>
<p><code>roomScript</code> HaxBall room script to load when starting Haxroomie.
<strong>Disables all other plugins!</strong>. See <a href="#using-own-room-scripts">running own room scripts section</a>.</p>
</li>
<li>
<p><code>hhmConfig</code> Path to custom Haxball Headless Manager (HHM) configuration file.
You rarely need this. See <a href="#using-own-hhm-config">Using own HHM config</a></p>
</li>
<li>
<p><code>plugins</code> Plugins that you want to load from the filesystem. This should
be an array of objects that contain the plugin name and file path.
<strong>The <code>pluginConfig</code> option does not affect these plugins!</strong></p>
<p>e.g.</p>
<pre class="prettyprint source lang-js"><code>  plugins: [
    {
      name: 'myplugin',
      path: '/path/to/myplugin.js'
    }
  ]
</code></pre>
<p>Useful for testing plugins before uploading them to a server or GitHub.</p>
</li>
<li>
<p><code>hhm</code> Path to built source of Headless Haxball Manager (HHM).
Useful for testing changes to the source.</p>
</li>
<li>
<p><code>disableDefaultPlugins</code> Set to <code>true</code> if you want to disable the default
HHM plugins that Haxroomie loads. This can be useful if for example you
want to test some plugins without others interfering with it.</p>
</li>
</ul>
<p>To configure more than one room just add a new property for the config object.</p>
<p>e.g.</p>
<pre class="prettyprint source lang-js"><code>let config = {
  'room1': {
    autoStart: true,
    roomName: 'haxroomie1',
    playerName: 'host',
    maxPlayers: 12,
    public: false,
    geo: { code: 'eu', lat: '52.5192', lon: '13.4061'},
  },
  'room2': {
    autoStart: true,
    roomName: 'haxroomie2',
    playerName: 'host',
    maxPlayers: 12,
    public: false,
    roomScript: 'path/to/room-script.js'
  }
};
module.exports = config;
</code></pre>
<h2>Running own room scripts</h2>
<p>You can run <strong>one</strong> room script by setting <a href="#config">the configs</a> <code>roomScript</code> property.
Running a script this way will disable the default Headless Haxball Manager
(HHM) plugins that Haxroomie loads
(except the ones that Haxroomie requires to work internally).</p>
<p>The scripts have few restrictions compared to vanilla room scripts mentioned in
<a href="https://haxplugins.tk/docs/tutorial-writing-plugins.html">HHM docs</a>.</p>
<p>HHM allows you to modularize your room script. Instead of one massive
JavaScript file you can implement the functionality in smaller modules called
plugins. Read the guide for writing own HHM plugins at
<a href="https://haxplugins.tk/docs/tutorial-writing-plugins.html">HHM docs</a>.
You can test them by loading them with <a href="#config">the configs</a> <code>plugins</code>
property.</p>
<p>To publish the plugins you should create your own
<a href="https://github.com/saviola777/haxball-headless-manager#creating-your-own-plugin-repository">HHM plugin repository</a>.</p>
<p>Use <a href="#config">the configs</a> <code>repositories</code> property to enable the repository and
<code>pluginConfig</code> property to set which plugins to enable and pass them
options.</p>
<h2>Using own HHM config</h2>
<p>Haxroomie supports providing a
<a href="https://github.com/saviola777/haxball-headless-manager#preparing-your-configuration">Haxball Headless Manager configuration file</a>.
However there should rarely be a reason to do this. The files have couple
requirements to work with Haxroomie
(see <a href="https://github.com/morko/haxroomie#hhm-config-requirements">HHM config requirements</a>).</p>
<h3>HHM config requirements</h3>
<p><code>HHM.config.room</code> property must have a <code>token</code> property like this:</p>
<pre class="prettyprint source lang-js"><code>HHM.config.room = {
  token: hrConfig.token
}
</code></pre>
<p>The <code>postInit</code> plugin should set the <code>window.hroomie.hhmStarted</code> property to
<code>true</code> on the <code>onRoomLink</code> event like this:</p>
<pre class="prettyprint source lang-js"><code>HHM.config.postInit = HBInit => {
  let room = HBInit();

  room.onRoomLink = () => {
    window.hroomie.hhmStarted = true;
  }
}
</code></pre>
<h3>Differences to vanilla HHM config</h3>
<p>Haxroomie injects a <code>hrConfig</code> object to the HHM config.
The object contains all the properties sent to the function
that is used to start the room.
See the
<a href="https://morko.github.io/haxroomie/RoomController.html#openRoom">API documentation for openRoom</a>
for a list of these properties.</p>
<p>See the
<a href="https://www.github.com/morko/haxroomie/tree/master/src/hhm/config.js">default configuration file</a>
for a complete example.</p>
<p>See
<a href="https://www.github.com/saviola777/haxball-headless-manager#preparing-your-configuration">HHM docs</a>
for more information about the configuration file.</p>
<h1>API</h1>
<p>To install haxroomie for your project its preferred to install it locally with</p>
<pre class="prettyprint source lang-sh"><code>npm install morko/haxroomie
</code></pre>
<p>To work with the API see <a href="https://morko.github.io/haxroomie/">the official documentation</a>.</p>
<p>Easiest way to create
<a href="https://morko.github.io/haxroomie/module-haxroomie.Haxroomie.html">Haxroomie instances</a>
is to use the asynchronous factory function <code>createHaxroomie</code> in the
<a href="https://morko.github.io/haxroomie/module-haxroomie.html#createHaxroomie">haxroomie module</a>.</p>
<p>Haxroomie controls one headless chrome browser with help of the Puppeteer library.
Each browser tab can run one HaxBall room. These browser tabs are controlled with
the <a href="https://morko.github.io/haxroomie/RoomController.html">RoomController</a> object.</p>
<h2>Example API usage</h2>
<p>Example that requires the token to be set as an environment variable named <code>HAXBALL_TOKEN</code>.</p>
<pre class="prettyprint source lang-js"><code>const { createHaxroomie } = require(`haxroomie`);

(async function bootstrap() {
  try {
    let haxroomie = await createHaxroomie();
    let room = await haxroomie.addRoom(`example`);
		
    room.on('open-room-start' (roomInfo) => {
      console.log(`Room started. Here is the link: ${roomInfo.roomLink}`);
    });
    room.openRoom({
      roomName: `haxroomie`,
      playerName: `host`,
      maxPlayers: 10,
      public: false,
      token: process.env.HAXBALL_TOKEN
    });
  } catch (err) {
    logger.error(err.stack);
    process.exit(1);
  }
})();

</code></pre></article>
		</section>
			</div>
				<div class="col-md-3 side-content">
					<nav class="toc hidden-print hidden-sm hidden-xs"></nav>
				</div>
		</div>
	</div>
	<footer>
				<div class="copyright">© Oskari Pöntinen 2019</div>
			<div class="generated-by">Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.2</a> on 5th Jun 2019 using the <a href="https://github.com/steveush/foodoc">FooDoc template</a>.</div>
	</footer>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/clipboard.min.js"></script>
	<script src="js/prism.min.js"></script>
	<script src="js/template.min.js"></script>
		<!-- start:lunr-search-modal.hbs -->
		<div class="modal fade" id="lunr-search-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Search results</h4>
					</div>
					<div class="modal-body" id="lunr-search-body">
					</div>
					<div class="modal-footer" id="lunr-search-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<!-- end:lunr-search-modal.hbs -->		<script src="js/lunr.min.js"></script>
	
</body>
</html>
<!-- end:readme.hbs -->